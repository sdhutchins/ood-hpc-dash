{% extends "base.html" %}

{% block content %}
<br/>
<h3 class="pb-2 mb-4 border-bottom">Settings</h3>
<p class="mb-4 text-muted">Configure navbar color and paths.</p>

<form action="{{ url_for('settings.save_settings') }}" method="post" class="mt-3">

  <div class="card mb-4 shadow-sm" style="border-radius: 10px;">
    <div class="card-body">
      <p class="text-muted small mb-3">Signed in as: <strong>{{ username or 'user' }}</strong></p>

      <label for="navbar_color" class="form-label fw-semibold">Navbar Color</label>
      <select id="navbar_color" name="navbar_color" class="form-select mb-3" aria-label="Select navbar color">
          {% for value, label in allowed_nav_colors %}
          <option value="{{ value }}" data-color="{{ value }}" {% if settings.navbar_color == value %}selected{% endif %}>
              {{ label }}
          </option>
          {% endfor %}
      </select>
      <div class="form-text">Choose from approved light colors only.</div>
      <div class="mt-2">
        <span class="badge rounded-pill text-dark" id="navbar_color_preview" style="background-color: {{ settings.navbar_color }};">Preview</span>
      </div>
    </div>
  </div>

  <div class="card mb-4 shadow-sm" style="border-radius: 10px;">
    <div class="card-body">
      <label for="code_editor_path" class="form-label fw-semibold">Code Editor Path</label>
      <input type="text" class="form-control mb-2" id="code_editor_path" name="code_editor_path"
             value="{{ settings.code_editor_path }}" placeholder="/absolute/path">
      <div class="form-text">Absolute path the code editor should use.</div>
    </div>
  </div>

  <div class="card mb-4 shadow-sm" style="border-radius: 10px;">
    <div class="card-body">
      <label for="conda_envs_paths" class="form-label fw-semibold">Conda Env Paths</label>
      <textarea class="form-control mb-2" id="conda_envs_paths" name="conda_envs_paths" rows="3"
                placeholder="$HOME/.conda&#10;$HOME/miniconda3/envs">{% for p in settings.conda_envs_paths %}{{ p }}
{% endfor %}</textarea>
      <div class="form-text">One path per line. Environment variables like $HOME are allowed.</div>
    </div>
  </div>

  <div class="card mb-4 shadow-sm" style="border-radius: 10px;">
    <div class="card-body">
      <label for="project_directories" class="form-label fw-semibold">Project Directories</label>
      <textarea class="form-control mb-2" id="project_directories" name="project_directories" rows="3"
                placeholder="$HOME/Documents/Git-Repos&#10;$HOME/Dev/src-repos">{% if settings.project_directories %}{% for p in settings.project_directories %}{{ p }}
{% endfor %}{% endif %}</textarea>
      <div class="form-text">One path per line. Base directories to scan for git repositories. Environment variables like $HOME are allowed.</div>
    </div>
  </div>

  <button type="submit" class="btn px-4 py-2" style="border-radius: 6px; background-color: var(--theme-bg-color); border-color: var(--theme-bg-color); color: var(--theme-text-color);">Save</button>

</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const select = document.getElementById('navbar_color');
  const preview = document.getElementById('navbar_color_preview');
  if (select && preview) {
    select.addEventListener('change', function() {
      const color = this.value;
      preview.style.backgroundColor = color;
    });
  }
});
</script>
{% endblock %}
